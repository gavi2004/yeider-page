{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registrar Pago</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Estilos compartidos -->
    <link rel="stylesheet" href="{% static 'users/css/home.css' %}">
    <link rel="stylesheet" href="{% static 'users/css/animate.css' %}">
    <link rel="shortcut icon" href="{% static 'users/imagenes/logazo.png' %}">
    <link rel="stylesheet" href="{% static 'users/fontawesome/css/all.min.css' %}">

    <style>
        .datos-operacion {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .datos-operacion table {
            width: 100%;
            margin-bottom: 15px;
        }
        .datos-operacion td {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .datos-operacion td:first-child {
            font-weight: bold;
            width: 40%;
        }
        .separador {
            border-top: 1px dashed #ccc;
            margin: 15px 0;
        }
        .metodo-pago {
            margin-top: 20px;
        }
        .metodo-pago h3 {
            margin-bottom: 15px;
        }
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .btn-pagar {
            background-color: #28a745;
            color: white;
        }
    </style>

    <script>
        function toggleCampos() {
            const metodo = document.getElementById("id_metodo").value;
            // Mostrar referencia solo para pago móvil
            document.getElementById("referencia_field").style.display = 
                (metodo === 'pmovil') ? 'block' : 'none';
            // Ocultar número de tarjeta (no lo usamos)
            document.getElementById("numero_tarjeta_field").style.display = 'none';
        }
        window.onload = function() {
            toggleCampos();
            document.getElementById("id_metodo").addEventListener("change", toggleCampos);
        };
    </script>
</head>
<body>

    <header class="menu animate__animated animate__fadeInDown">
        <h1 class="animate__animated animate__bounceInDown">Cancela Tu Pago</h1>
        <img src="{% static 'users/imagenes/logazo.png' %}" class="logo animate__animated animate__zoomIn animate__delay-1s" alt="Logo">
        <nav>
            <ul class="nav-list animate__animated animate__fadeInDown">
                <li class="nav-item animate__animated animate__fadeInLeft animate__delay-1s">
                    <a href="{% url 'home_cliente' %}" class="icon-link">
                        <i class="fas fa-house"></i>
                        <span class="icon-text">Inicio</span>
                    </a>
                </li>
                <li class="nav-item animate__animated animate__fadeInLeft animate__delay-2s">
                    <a href="{% url 'destiny' %}" class="icon-link">
                        <i class="fas fa-plane-departure"></i>
                        <span class="icon-text">Destinos</span>
                    </a>
                </li>
                <li class="nav-item animate__animated animate__fadeInLeft animate__delay-3s">
                    <a href="{% url 'enviar_paquete' %}" class="icon-link">
                        <i class="fas fa-box"></i>
                        <span class="icon-text">Paquetes</span>
                    </a>
                </li>
                <li class="nav-item animate__animated animate__fadeInLeft animate__delay-4s">
                    <a href="{% url 'ver_carrito' %}" class="icon-link">
                        <i class="fas fa-cart-shopping"></i>
                        <span class="icon-text">Carrito</span>
                    </a>
                </li>
                <li class="nav-item animate__animated animate__fadeInLeft animate__delay-5s">
                    <a href="{% url 'mis_boletos' %}" class="icon-link">
                        <i class="fa-solid fa-ticket"></i>
                        <span class="icon-text">Mis Boletos</span>
                    </a>
                </li>
                <li class="nav-item animate__animated animate__fadeInLeft animate__delay-6s">
                    <a href="{% url 'logout' %}" class="icon-link">
                        <i class="fas fa-door-closed"></i>
                        <span class="icon-text">Cerrar Sesión</span>
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <main class="page-container">
        <section class="formulario-registro fade-in">
            <div class="form-container">

                {% if messages %}
                    <ul class="messages">
                        {% for message in messages %}
                            <li class="message">{{ message }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <div class="datos-operacion animate__animated animate__fadeInRight">
                    <h3>Datos de la operación</h3>
                    <table>
                        <tr>
                            <td>Importe:</td>
                            <td>{{ total }} Bs</td>
                        </tr>
                        <tr>
                            <td>Cliente:</td>
                            <td>{{ usuario_actual.nombre }}</td>  <!-- Aquí se usa el nombre -->
                        </tr>
                        <tr>
                            <td>Fecha:</td>
                            <td>{% now "d/m/Y H:i" %}</td>
                        </tr>
                        
                    </table>

                    <div class="separador"></div>

                    <div class="metodo-pago">
                        <h3>Pagar con Tarjeta</h3>
                        <form method="POST" enctype="multipart/form-data" class="payment-form">
                            {% csrf_token %}

                            <input type="hidden" name="monto" value="{{ total }}" id="id_monto">
                            <div class="form-group" id="referencia_field">
                                <label for="id_referencia">
                                    <i class="fas fa-hashtag"></i> N° de Referencia Pago Móvil
                                </label>
                                <input type="text" name="referencia" id="id_referencia" class="form-control" placeholder="Ej: 12345678" required />
                            </div>

                            <div class="form-group">
                                <label for="id_metodo"><i class="fas fa-money-check-alt"></i> Método de Pago</label>
                                <select name="metodo" id="id_metodo" class="form-control">
                                    <option value="pmovil">Pago Móvil</option>
                                </select>
                            </div>
                            

                            <div class="form-group">
                                <label for="id_comprobante">
                                    <i class="fas fa-camera"></i> Comprobante
                                </label>
                                <input type="file" name="comprobante" id="id_comprobante" class="form-control" />
                            </div>

                            <div class="form-group">
                                <label for="id_observaciones">
                                    <i class="fas fa-comment"></i> Observaciones
                                </label>
                                <textarea name="observaciones" id="id_observaciones" class="form-control" rows="3"></textarea>
                            </div>

                            <div class="btn-container">
                                <a href="{% url 'home_cliente' %}" class="btn secondary">
                                    <i class="fas fa-arrow-left"></i> Cancelar
                                </a>
                                <button type="submit" class="btn btn-pagar">
                                    <i class="fas fa-check"></i> Pagar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer-login animate__animated animate__fadeInUp animate__delay-2s">
        <p>&copy; 2025 Sistema de Gestión. Todos los derechos reservados.</p>
    </footer>

    <script>
        function confirmarCompra() {
            if (confirm("¿Estás seguro de que deseas confirmar el pago?")) {
                document.querySelector('.payment-form').submit();
            }
        }
    </script>

</body>
</html>